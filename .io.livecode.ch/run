#!/bin/bash
set -e


cat $2 $1 >hout.scm
read -r headline <hout.scm
tail -n +2 hout.scm >out.scm

echo "(load-option 'format)" >format.scm

case "$headline" in
    black)
        cd black
        mechanics-shell --load ../format.scm --load init.scm <../out.scm | tail -n +15
        ;;
    blond)
        cd blond
        mechanics-shell --load ../format.scm --load mit.scm --load blond.scm --load boot.scm <../out.scm | tail -n +15
        ;;
    brown)
        cd brown
        cat lib.brn ../out.scm >out.brn
        mechanics-shell --load ../format.scm --load brown.scm --load boot.scm <out.brn | tail -n +13
        ;;
    *)
        echo "error: unknown headline $headline"
        ;;
esac
